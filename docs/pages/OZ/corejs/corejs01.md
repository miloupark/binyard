# 불변 객체 (Immutable Object) <Badge type="tip" text="1 - 5" />

:::info 🎯 Learning Goals

- 불변 객체의 개념과 의미
- 얕은 복사 vs 깊은 복사 차이

:::

## 1. 불변 객체란?

한 번 생성되면 내부 상태가 바뀌지 않는 객체<br>
즉, 객체의 값을 직접 바꾸는 것이 아니라, 변경이 필요하면 새로운 객체를 생성해서 사용한다.

📷 불변 객체는 ‘사진’처럼, 한 번 찍히면 그 상태로 남아있는 것과 같다. <br>
✍️ 상태를 바꾸고 싶다면? 새로운 사진을 찍는 것이다.

::: info 💡 불변 객체 원칙
한 번 만들어진 객체는 절대 바뀌지 않아야 한다. <br>
대신, 변경이 필요한 경우에는 원본을 건드리지 않고 ‘복사본’을 만들어 작업한다.

자바스크립트 자체가 "불변 객체를 강제하진 않지만, 개발 관점에서 권장되는 패턴이다.<br>
특히 복잡한 애플리케이션을 만들거나 상태 관리를 다룰 때는 필수적인 습관처럼 여겨지기 때문.
:::

## 2. 왜 중요할까?

✅ 예측 가능한 코드

- 데이터 변경을 명확하게 추적할 수 있고, 사이드 이펙트를 줄일 수 있다.

✅ 협업에 안전

- 공유된 객체를 수정하지 않으므로, 다른 곳에 예상치 못한 영향을 주지 않는다.

✅ 프론트엔드 프레임워크와의 연계

React나 Redux처럼 상태 관리가 중요한 라이브러리에서는 불변 객체 원칙이 필수이다.

- React: 상태 변경 시 반드시 새로운 객체를 리턴해야 함 (useState, setState)
- Redux: 상태를 절대로 직접 수정하지 않고, 리듀서를 통해 새 상태를 반환
- Immer: 내부적으로 불변성을 유지하면서도 편하게 코드 작성 가능

::: info 🚨 side effect
자바스크립트에서 객체는 `참조형`입니다. <br>
즉, 변수에는 값이 아니라 객체가 저장된 메모리 주소가 담기고, 그 주소를 통해 여러 변수가 동일한 객체를 참조할 수 있다.

```js
var user = { name: "Jaenam" };
var user2 = user;

user2.name = "Jung";
```

- user와 user2는 서로 다른 변수지만 같은 객체를 가리키고 있기 때문에,
  user2.name을 변경하면 user.name도 함께 변경된다.
- 이처럼 참조를 공유하는 객체를 직접 수정하면 예기치 못한 부작용이 발생할 수 있다.
- 이러한 문제를 막기 위해, 객체를 불변하게 다루는 습관이 중요하다.

:::

<br>

### 3. 얕은 복사 vs 깊은 복사

#### `얕은 복사`

```js
var user = {
  name: "Jaenam",
  urls: {
    blog: "http://blog.com",
  },
};

var user2 = copyObject(user);
```

- `user2.urls.blog`를 바꾸면, `user.urls.blog`도 같이 바뀌는 문제가 발생한다.
  urls는 여전히 `같은 주소`를 참조하고 있기 때문.

<br>

#### `깊은 복사`

이 문제를 해결하려면 중첩된 객체까지 따라 들어가면서 전부 새로 복사해야 한다.
이걸 `깊은 복사(deep copy)`라고 한다.

```js
var copyObjectDeep = function (target) {
  var result = {};
  if (typeof target === "object" && target !== null) {
    for (var prop in target) {
      result[prop] = copyObjectDeep(target[prop]);
    }
  } else {
    result = target;
  }
  return result;
};
```

- `copyObjectDeep()` 함수는 객체이든 배열이든 몇 단계로 중첩돼 있든 전부 따라가면서 복사한다.
  이렇게 하면 원본과 복사본이 완전히 분리된 상태가 된다.

<br>

## 4. 간단하게 복사하는 방법: JSON

```js
var newObj = JSON.parse(JSON.stringify(obj));
```

- 내부 구조를 전부 문자열로 바꿨다가 객체로 다시 바꾸기 때문에, 깊은 복사처럼 동작한다.
- 하지만, 이 방법은 함수, undefined, Symbol, Date, Map, Set, 순환 참조 등은 복사 안 되기 때문에 주의가 필요하다.

<br>

::: info 📌 요약

- 객체를 직접 수정하면 의도치 않은 부작용이 생길 수 있다.
- 불변 객체로 다루면 상태를 예측 가능하게 만들 수 있다
- 얕은 복사만으로는 중첩된 구조를 복사할 수 없기 때문에, 상황에 따라 깊은 복사 또는 라이브러리/JSON 방식을 사용하는 게 좋다.

:::
